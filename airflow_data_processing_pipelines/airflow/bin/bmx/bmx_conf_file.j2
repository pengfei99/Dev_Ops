#!/bin/bash

#== STEPS ==#
DO_FILTERING_QC=1   # IF 0 FILTERING AND QC STEP OMITED, IF 1 PERFOM FILTERING AND QC STEP
DO_HOST_FILTERING=0 # IF 0 HOST FILTERING STEP OMITED,   IF 1 PERFOM HOST FILTERING STEP
DO_MERGE_READS=1	# IF 0 MERGE READS STEP MOTIED,      IF 1 PERFORM MERGE READS
DO_MAPPING=1        # IF 0 MAPPING STEP OMITED,          IF 1 PERFOM MAPPING STEP
DO_BAM_MERGE=1      # IF 0 BAM MERGING STEP OMITED,      IF 1 PERFOM BAM MERGING STEP
DO_LCA=1            # IF 0 LCA STEP OMITED,              IF 1 PERFOM LCA STEP

#== INPUT FILE PARAMS FOR SHOTGUN PIPELINE
GZ_BOOL_METAG=0 # IF 0 INPUT FASTQ ARE NOT .GZ; IF 1 INPUT FASTQ ARE .GZ
PAIRED=1

##== CALCULATION SERVERS PARAMETERS ==#
SGE_METAG=0     # IF 0 QSUB NOT USED,               IF 1 QSUB IS USED
VERBOSE_METAG=1 # IF 0 MODE SILENCE,                IF 1 MODE VERBOSE
WRITE_TMP=0     # IF 0 PROCESS IN OUTPUT DIRECTORY, IF 1 PROCESS IN data/TMP AND MOVE IN OUTPUT DIRECTORY AT THE END

#== QC PARAMETERS =#
MIN_READ_LENGTH=50       # MINIMUM READ LENGTH
QUAL_THRESHOLD=25        # QUALITY THRESHOLD
PERCENT_CONFIDENT_BPS=80 # MINIMUM PERCENT OF BASES THAT MUST HAVE A QUALITY SCORE HIGHER THAN THE FIXED THRESHOLD
MISEQ_PREPROC=1          # FOR PAIRED-END DATA FROM MISEQ USE 1. ELSE 0

#== HOST FILTERING STRATEGY ==#
METHOD=compa # IF COMPA HOST FILTERING WITH COMPARATIVE APPROACHE, IF COMPO WITH COMPOSITIONNAL APPROACH
# REF_DB_HUMAN=/Master_Data/BioSeq/RefDB_HumanGenome_V0.2/Homo_sapiens_GRCh37.p2_whole_genome.fa # PATH TO HUMAN REFDB

## TAXONOMY
TAXO_DB=/mnt/gpfs/pt6/airflow/bmx_pipeline_dependencies/NCBI_Taxonomy/20170223/ncbi-taxo.db # PATH TO TAXONOMIC DATABASE. SAME WE USED TO BUILD THE REFDBS !!!!!

#== PATH TO REFERENCE FILES ==#
# PATH TO REF DB BWA
REF_DB_16S={{ db_path }}/{{ db_name }}.fasta
REF_DB_TABLE_BWAMEM=( ${REF_DB_16S} ) # TABLE OF REFDB FOR BWA-MEM OR BWA-MEM-PAIRED, IF TMAP IS CHOSEN REPLACE REF_DB_TABLE_BWAMEM BY REF_DB_TABLE_TMAP. ONLY REF_DB_TABLE_BWASW, REF_DB_TABLE_BWA, REF_DB_TABLE_BWAMEM, REF_DB_TABLE_BOWTIE2 AND REF_DB_TABLE_TMAP ARE ACCEPTED

#INPUT MAP FILE GI 2 TAXIDS
INPUT_MAP_16S={{ db_path }}/{{ db_name }}.txt
INPUT_MAP_TABLE=( ${INPUT_MAP_16S} )

#== METAGENOMICS MAPPING STRATEGY ==#
TOT_STEP_MAPPING_METAG=1         # NUMBER OF REF_DB (>0)
SEQUENTIAL_MAPPING_METAG=0       # IF 0 NOT SEQUENTIAL MAPPING (MORE THA NONE MAPPER) FOR EACH REFDB. IF 1 SEQUENTIAL MAPPING FORE EACH REFDB. MUST BE 0. NOT WORKING FOR 1 FOR THE MOMENT.
OUTPUT_MAPPING_TABLE=( Mapping ) # TABLE OF NAMES FOR OUTPUT DIRECTORIES (ONE FOR EACH REFDB). NUMBER OF NAMES EQUAL TO NUMBER OF REFDB. SAME ORDER THAN REFDB

#== COMPUTATION SERVER PARAMS
THREADS=10   # NUMBER OF THREADS USED FOR EACH STEP OF MAPPING (4 REFDB --> 4 x 10 THREADS)
PROJECT=B2723 # TO REFERENCE THE JOBS LAUNCHED
SGE=0         # FOR LAUNCH ALIGNER (VARIABLE LSF IN SCRIPT). MUST BE 0.

#== INPUT FILE PARAMS
GZ_BOOL=0 # FOR MAPPING.SH. IF 0 INPUT FASTQ ARE NOT .GZ; IF 1 INPUT FASTQ ARE .GZ. MUST BE 0 BECAUSE PIPELINE GUNZIP FASTQ IF GZ_BOOL_METAG=1 --> FASTQ NEVER GZIP WHEN MAPPING.SH IS LAUNCHED

#== RUNNING MODE PARAMS
VERBOSE=${VERBOSE_METAG} # FOR MAPPING.SH. IF 0 MODE SILENCE. IF 1 MODE VERBOSE
CLEANING=1               # FOR LAUNCHALIGNER. IF 0 NOT CLEANING INTERMEDIATE FILES. IF 1 CLEANING INTERMEDIATES FILES

#== MAPPING STRATEGY
TOT_STEP=1           # NUMBER OF MAPPER(S). MUST BE 1. NOT DEVELOPPED FOR SEVERAL MAPPER IN SAME TIME FOR THE MOMENT
SEQUENTIAL=0         # FOR LAUNCH ALIGNER  : 0 IF TOT_STEP=1 OR 1 IF TOT_STEP > 1. MUST BE 0 LIKE TOT_STEP MUST BE 1. (NO EFFECT IF EQUAL TO 1 WHEN TOT_STEP=1)
COMPRESS_ALIGNMENT=1 # FOR LAUNCH ALIGNER  : IF 0 KEEP AS SAM FILE IF 1 CONVERT TO BAM, SORT AND DELETE SAM. MUST TO BE 1.
SAM_SORT_LEXICO=1    # FOR LAUNCH ALIGNER  : IF 0 samtools sort (sort by chromosomal coordinates) IF 1 samtools sort -n (Sort by read names ). MUST TO BE 1.
FASTQ_OUT=0          # FOR UNMMAPED.SH  : IF 0 NOT GENERATE FASTQ, IF 1 GENERATE FASTQ. IF SEQUENTIAL=0 FASTQOUT HAS NO EFFECT. SO, NO EFFECT HERE IF YOU CHOOSE 1.

BAM2BH_OPTIONS="--compare-match-minus-ed --full-hit-name -p 0" # BAM2BH_OPTIONS for mapping step --> mgx-seq-bam2bh --h  (command to see help)
nameOFmappers=(bwa-mem) # NAME OF THE MAPPER. ONLY ONE MAPPER !! AVAILABLE MAPPERS : bwa-sw, bwa-mem, bowtie2, tmap, bwa, bwa-mem-paired, bowtie2-paired, bwa-paired, tmap-paired
BWAMEM_OPTION='"-a -T 0 -k 19 -d 80 -r 1.5 -L 7"' # CALL IN MAPPING.SH TO LAUNCH LAUNCHALIGNER.SH. BWAMEM OPTIONS for mapping step --> bwa mem (command to see help).
#NAME OF VARIABLES OK FOR MAPPER_OPTION :
# - BWASW_OPTION FOR bwa-sw : BWASW_OPTION=='"NA_OPTIONS"' ## BWASW options as a character string !! IMPORTANT !!
# - BWAMEM_OPTION FOR bwa-mem AND bwa-mem-paired : BWAMEM_OPTION='"-a -T 0 -k 19 -d 80 -r 1.5 -L 7"'
# - BOWTIE2_OPTION FOR bowtie2 AND bowtie2-paired : BOWTIE2_OPTION='"-k 5 -N 0 -L 20 -i S,1,0.50"' ##bowtie2 options !! IMPORTANT !!
# - TMAP_OPTION FOR tmap AND tmap-paired : TMAP_OPTION='"-a 2 -g 3 -v stage1 map1 map2 map3"' ## TMAP options as a character string !! IMPORTANT !!
# - BWA_ALN_OPTION FOR bwa AND bwa-paired

